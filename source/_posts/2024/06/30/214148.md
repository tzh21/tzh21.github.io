---
title: "AN UNFORGEABLE PUBLICLY VERIFIABLE WATERMARK FOR LARGE LANGUAGE MODELS 论文笔记"
date: 2024-06-30 21:41:48
tags:
---

## 动机

KGW 模型使用在生成和检测水印时使用的是同一个 key（包括 hash function 和 random number generator）。只有 key 的持有者才能检测水印。这意味着检测的过程是不能公开的。

如果在生成和检测水印的过程中使用不同的 key，这样就可以只公开检测水印的 key，即能让公众检测水印，也不会泄露生成水印的 key。

## 生成水印

已有一个语言模型，希望得到一个能够在输出中嵌入水印的新语言模型。

在生成文本的过程中，现在需要生成第 n 个 token $x_n$。

记窗口大小为 w，根据前面 w - 1 个 token 计算第 n 个位置的 logits，取最高的 K 个备选 token，记为 $\{x_n^{(0)},..., x_n^{(K-1)}\}$

在这 K 个备选 token 中，划分一部分作为绿列表（具体方法见后文），提高 logits 值。

修正 logits 后的新语言模型即为所求。

## 求绿列表

求窗口内所有 token 的 embedding，然后将它们拼接起来，输入全连接神经网络 FFN 中，得到最后一个 token 是否为绿列表中的元素。

$$
W(x_{n-w+1:n}) = FFN(E(x_{n-w+1})\oplus ...\oplus E(x_{n}))
$$

难点是如何让神经网络保持生成 $\gamma$ 比例的绿列表。

## 利用 z 检验进行水印检测

考虑神经网络不能严格生成 $\gamma$ 比例的绿列表，只能在期望上等于 $\gamma$，所以需要在 z 检验中考虑绿列表比例的方差。

## 利用神经网络进行水印检测

采用二分类长短期记忆网络（LSTM）检测水印。

## 不可伪造性

神经网络是不可逆的。很难根据输出推断输入。

用水印生成模型的结果训练水印检测模型。但已知水印检测模型，很难反过来推测出水印生成模型的训练输入和输出。
